<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QWMY</title>
  <style>
  @font-face { font-family: 'CustomFont'; src: url('fonts/Thin.ttf'); font-weight: 100; }
  @font-face { font-family: 'CustomFont'; src: url('fonts/ExtraLight.ttf'); font-weight: 200; }
  @font-face { font-family: 'CustomFont'; src: url('fonts/Light.ttf'); font-weight: 300; }
  @font-face { font-family: 'CustomFont'; src: url('fonts/Regular.ttf'); font-weight: 400; }
  @font-face { font-family: 'CustomFont'; src: url('fonts/Medium.ttf'); font-weight: 500; }
  @font-face { font-family: 'CustomFont'; src: url('fonts/SemiBold.ttf'); font-weight: 600; }
  @font-face { font-family: 'CustomFont'; src: url('fonts/Bold.ttf'); font-weight: 700; }
  @font-face { font-family: 'CustomFont'; src: url('fonts/ExtraBold.ttf'); font-weight: 800; }
  @font-face { font-family: 'CustomFont'; src: url('fonts/Black.ttf'); font-weight: 900; }

  .color-picker { position: relative; display: inline-block; }
  .color-picker-popup {
    position: fixed;
    bottom: 70px;
    left: 10px;
    background: #333;
    color: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
    z-index: 1001;
    display: none;
    max-height: 80vh;
    overflow-y: auto;
  }
  .color-palette {
    display: grid;
    grid-template-columns: repeat(auto-fit, 30px);
    gap: 5px;
    margin-bottom: 10px;
    justify-content: start;
  }
  .color-item {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #444;
    transition: transform 0.2s;
  }
  .color-item:hover { transform: scale(1.1); }
  .hex-input {
    width: 100%;
    padding: 8px;
    margin: 10px 0;
    border: 1px solid #444;
    border-radius: 5px;
    text-align: center;
    background: #555;
    color: white;
  }
  .color-actions { display: flex; gap: 5px; }
  .color-actions button { flex: 1; padding: 8px; }

  .toolbar { 
    background: #222;
    padding: 0.5rem;
    display: flex;
    gap: 0.5rem;
    justify-content: flex-start;
    align-items: center;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
    position: fixed;
    bottom: 0;
    width: 100%;
    overflow-x: auto;
    white-space: nowrap;
    max-width: 100vw;
  }
  
  .toolbar label {
    display: flex;
    align-items: center;
    gap: 5px;
    background: #444;
    padding: 5px 10px;
    border-radius: 8px;
    color: white;
  }

  * { 
    font-family: 'CustomFont', sans-serif; 
    box-sizing: border-box; 
    margin: 0;
    padding: 0;
  }

  body { 
    background: #181818;
    color: white;
    min-height: 100vh;
    padding-bottom: 60px;
  }

  .top-bar { 
    background: #222;
    padding: 1rem;
    display: flex;
    gap: 1rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    position: sticky;
    top: 0;
    z-index: 1000;
  }

  button {
    background: #9a7502;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
    border : 3px solid #9a7502 ;
  }

  button:hover , .button1:hover  { 
    background: #ffc200; 
    color: #9a7502;
    border : 3px solid #9a7502 ;
  }
  
.button1 {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 30px;         /* حجم الزر */
  height: 30px;
  margin: 2px;         /* تباعد بين الأزرار */
  border: none;
  border-radius: 8px; /* حواف دائرية */
  background: #9a7502;
  color: white;        /* لون الأيقونة */
  font-size: 12px;     /* حجم الأيقونة */
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}



  .editor-container {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 1rem;
  }

  .canvas-wrapper {
    background: #333;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
    padding: 20px;
    margin: 20px 0;
    position: relative;
  }

  #newsCanvas {
    width: 100%;
    height: auto;
    border: 2px dashed #444;
    border-radius: 10px;
    background-size: cover;
  }

  .hidden { display: none; }

  select, input[type="color"], input[type="number"] {
    padding: 0.5rem;
    border-radius: 8px;
    border: 1px solid #444;
    font-size: 0.6rem;
    background: #555;
    color: white;
  }

  .transform-controls {
    position: fixed;
    bottom: 70px;
    right: 10px;
    background: #333;
    padding: 15px;
    border-radius: 10px;
    display: none;
    gap: 5px;
    grid-template-columns: repeat(3, 1fr);
  }

  .transform-controls button {
    padding: 8px;
    min-width: 40px;
  }
</style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <div class="top-bar">
    <button id="undoBtn"><i class="fas fa-undo"></i> تراجع</button>
    <button id="saveBtn"><i class="fas fa-save"></i> حفظ الصورة</button>
  </div>

  <div class="editor-container">
    <div class="canvas-wrapper">
      <canvas id="newsCanvas"></canvas>
    </div>
  </div>

  <div class="toolbar">
    <button id="addImageBtn"><i class="fas fa-image"></i> إضافة صورة</button>
    <button id="addHeadlineBtn"><i class="fas fa-heading"></i> إضافة نص الخبر</button>
    <button id="transformBtn"><i class="fas fa-arrows-alt"></i> تحريك الصورة</button>

    <div class="color-picker">
      <button class="text-color-trigger"><i class="fas fa-paint-brush"></i> لون النص</button>
      <div class="color-picker-popup text-color-picker">
        <div class="color-palette" id="textColorPalette"></div>
        <input type="text" class="hex-input" placeholder="#FFFFFF">
        <div class="color-actions">
          <button class="picker-btn"><i class="fas fa-eyedropper"></i> اختر</button>
          <button class="confirm-btn">تطبيق</button>
        </div>
      </div>
    </div>

    <div class="color-picker">
      <button class="bg-color-trigger"><i class="fas fa-fill"></i> لون الخلفية</button>
      <div class="color-picker-popup bg-color-picker">
        <div class="color-palette" id="bgColorPalette"></div>
        <input type="text" class="hex-input" placeholder="#000000">
        <div class="color-actions">
          <button class="picker-btn"><i class="fas fa-eyedropper"></i> اختر</button>
          <button class="confirm-btn">تطبيق</button>
        </div>
      </div>
    </div>

    <label>الوزن:
      <select id="fontWeightSelect">
        <option value="100">Thin</option>
        <option value="200">ExtraLight</option>
        <option value="300">Light</option>
        <option value="400" selected>Regular</option>
        <option value="500">Medium</option>
        <option value="600">SemiBold</option>
        <option value="700">Bold</option>
        <option value="800">ExtraBold</option>
        <option value="900">Black</option>
      </select>
    </label>

    <label>الحجم:
      <input type="number" id="fontSize" value="48" min="10" max="120">
    </label>
  </div>

  <div class="transform-controls" id="transformControls">
    <button class="button1" id="zoomIn"><i class="fas fa-search-plus"></i></button>
    <button class="button1" id="zoomOut"><i class="fas fa-search-minus"></i></button>
    <button class="button1" id="moveUp"><i class="fas fa-arrow-up"></i></button>
    <button class="button1" id="moveDown"><i class="fas fa-arrow-down"></i></button>
    <button class="button1" id="moveLeft"><i class="fas fa-arrow-left"></i></button>
    <button class="button1" id="moveRight"><i class="fas fa-arrow-right"></i></button>
  </div>

  <input type="file" id="imageInput" class="hidden" accept="image/*">
  <input type="color" id="hiddenColorInput" class="hidden">

  <script>
    const canvas = document.getElementById('newsCanvas');
    const ctx = canvas.getContext('2d');
    const presetColors = ['#FFFFFF', '#000000', '#9a7502', '#FFC200'];

    let currentTextColor = '#FFFFFF';
    let currentBgColor = '#000000';
    let currentFontSize = 48;
    let currentFontWeight = 400;
    let activeColorPicker = null;
    let history = [];
    let logoImg = new Image();
    let backgroundImage = null;
    let textElements = [];
    
    let imgScale = 1;
    let imgX = 0;
    let imgY = 0;

    logoImg.src = 'assets/Logo White long shadow.png';

    function setCanvasSize() {
      canvas.width = 1080;
      canvas.height = 1080;
      canvas.style.width = '100%';
      canvas.style.height = 'auto';
    }

    function drawBaseDesign() {
      ctx.fillStyle = '#f8f9fa';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      drawLogo();
    }

    function drawLogo() {
      if (!logoImg.complete) return;
      const logoWidth = 250;
      const margin = 0;
      const logoHeight = (logoImg.naturalHeight / logoImg.naturalWidth) * logoWidth;
      ctx.drawImage(logoImg, canvas.width - logoWidth - margin, margin, logoWidth, logoHeight);
    }

    function redrawAll() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      if (backgroundImage) {
        const scaledWidth = backgroundImage.width * imgScale;
        const scaledHeight = backgroundImage.height * imgScale;
        
        const drawX = imgX - scaledWidth/2;
        const drawY = imgY - scaledHeight/2;
        
        ctx.drawImage(
          backgroundImage, 
          drawX, 
          drawY, 
          scaledWidth, 
          scaledHeight
        );
      } else {
        ctx.fillStyle = '#f8f9fa';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
      
      textElements.forEach(textInfo => {
        drawTextElement(textInfo.text);
      });
      
      drawLogo();
      saveState();
    }

    function drawTextElement(text) {
      const paddingTop = 40;
      const paddingBottom = 100;
      const paddingSides = 40;
      const fontSize = currentFontSize;
      const weight = currentFontWeight;
      const containerWidth = 1080;
      const x = canvas.width / 2;

      ctx.font = `${weight} ${fontSize}px 'CustomFont'`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';

      const words = text.split(' ');
      let lines = [], line = '';
      const textAreaWidth = containerWidth - paddingSides * 2;

      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > textAreaWidth && n > 0) {
          lines.push(line);
          line = words[n] + ' ';
        } else {
          line = testLine;
        }
      }
      lines.push(line);

      const lineHeight = fontSize + 10;
      const containerHeight = lines.length * lineHeight + paddingTop + paddingBottom;
      const startY = canvas.height - containerHeight;

      ctx.fillStyle = currentBgColor;
      ctx.fillRect(x - containerWidth / 2, startY, containerWidth, containerHeight);

      ctx.beginPath();
      ctx.moveTo(x - containerWidth / 2, startY);
      ctx.lineTo(x + containerWidth / 2, startY);
      ctx.lineWidth = 10;
      ctx.strokeStyle = '#9a7502';
      ctx.stroke();

      ctx.fillStyle = currentTextColor;
      let textY = startY + paddingTop;
      for (let i = 0; i < lines.length; i++) {
        ctx.fillText(lines[i].trim(), x, textY);
        textY += lineHeight;
      }
    }

    function initColorPalettes() {
      const fillPalette = (containerId) => {
        const container = document.getElementById(containerId);
        container.innerHTML = presetColors.map(color => `
          <div class="color-item" style="background: ${color}" data-color="${color}"></div>
        `).join('');
      };

      fillPalette('textColorPalette');
      fillPalette('bgColorPalette');

      document.querySelectorAll('.color-item').forEach(item => {
        item.addEventListener('click', (e) => {
          const color = e.target.dataset.color;
          if (activeColorPicker === 'text') {
            currentTextColor = color;
          } else {
            currentBgColor = color;
          }
          updateColorInputs();
          redrawAll();
        });
      });
    }

    function updateColorInputs() {
      const currentColor = activeColorPicker === 'text' ? currentTextColor : currentBgColor;
      document.querySelectorAll(`.${activeColorPicker}-color-picker .hex-input`).forEach(input => {
        input.value = currentColor.toUpperCase();
      });
    }

    function saveState() {
      history.push(canvas.toDataURL());
      if (history.length > 10) history.shift();
    }

    document.querySelectorAll('.color-picker button').forEach(trigger => {
      trigger.addEventListener('click', (e) => {
        const picker = trigger.nextElementSibling;
        const isVisible = picker.style.display === 'block';
        document.querySelectorAll('.color-picker-popup').forEach(p => p.style.display = 'none');
        if (!isVisible) {
          const rect = trigger.getBoundingClientRect();
          picker.style.left = `${rect.left}px`;
          picker.style.bottom = `${window.innerHeight - rect.top + 10}px`;
          picker.style.display = 'block';
          activeColorPicker = picker.classList.contains('text-color-picker') ? 'text' : 'bg';
        }
      });
    });

    document.querySelectorAll('.picker-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.getElementById('hiddenColorInput').click();
      });
    });

    document.getElementById('hiddenColorInput').addEventListener('input', (e) => {
      const color = e.target.value;
      if (activeColorPicker === 'text') {
        currentTextColor = color;
      } else {
        currentBgColor = color;
      }
      updateColorInputs();
      redrawAll();
    });

    document.querySelectorAll('.confirm-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.color-picker-popup').forEach(p => p.style.display = 'none');
      });
    });

    document.addEventListener('click', (e) => {
      if (!e.target.closest('.color-picker')) {
        document.querySelectorAll('.color-picker-popup').forEach(p => p.style.display = 'none');
      }
    });

    document.getElementById('addImageBtn').addEventListener('click', () => {
      document.getElementById('imageInput').click();
    });

    document.getElementById('imageInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
          const targetWidth = 1080;
          const scaleFactor = targetWidth / img.width;
          
          imgScale = scaleFactor;
          imgX = canvas.width / 2;
          imgY = canvas.height / 2;
          
          backgroundImage = img;
          redrawAll();
        }
        img.src = event.target.result;
      }
      reader.readAsDataURL(file);
    });

    document.getElementById('addHeadlineBtn').addEventListener('click', () => {
      const text = prompt('أدخل نص العنوان:');
      if (text) {
        textElements.push({ text });
        redrawAll();
      }
    });

    document.getElementById('undoBtn').addEventListener('click', () => {
      if (history.length > 1) {
        history.pop();
        const img = new Image();
        img.onload = function() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);
        }
        img.src = history[history.length - 1];
      }
    });

    document.getElementById('saveBtn').addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'news-image.png';
      link.href = canvas.toDataURL();
      link.click();
    });

    document.getElementById('fontSize').addEventListener('input', (e) => {
      currentFontSize = parseInt(e.target.value);
      redrawAll();
    });

    document.getElementById('fontWeightSelect').addEventListener('change', (e) => {
      currentFontWeight = e.target.value;
      redrawAll();
    });

    document.getElementById('transformBtn').addEventListener('click', () => {
      const controls = document.getElementById('transformControls');
      controls.style.display = controls.style.display === 'grid' ? 'none' : 'grid';
    });

    document.addEventListener('click', (e) => {
      const controls = document.getElementById('transformControls');
      if (!e.target.closest('#transformControls') && !e.target.matches('#transformBtn')) {
        controls.style.display = 'none';
      }
    });

    const transformStep = 10;
    
    function adjustScale(newScale) {
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const deltaScale = newScale / imgScale;
      imgX = centerX - (centerX - imgX) * deltaScale;
      imgY = centerY - (centerY - imgY) * deltaScale;
      imgScale = newScale;
    }

    document.getElementById('zoomIn').addEventListener('click', () => {
      adjustScale(imgScale * 1.1);
      redrawAll();
    });

    document.getElementById('zoomOut').addEventListener('click', () => {
      adjustScale(imgScale * 0.9);
      redrawAll();
    });

    document.getElementById('moveUp').addEventListener('click', () => {
      imgY -= transformStep;
      redrawAll();
    });

    document.getElementById('moveDown').addEventListener('click', () => {
      imgY += transformStep;
      redrawAll();
    });

    document.getElementById('moveLeft').addEventListener('click', () => {
      imgX -= transformStep;
      redrawAll();
    });

    document.getElementById('moveRight').addEventListener('click', () => {
      imgX += transformStep;
      redrawAll();
    });

    setCanvasSize();
    logoImg.onload = drawBaseDesign;
    initColorPalettes();
  </script>
</body>
</html>